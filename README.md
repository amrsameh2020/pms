# نظام إدارة العقارات والفواتير الإلكترونية (متوافق مع ZATCA)

هذا المشروع هو نظام إدارة عقارات مبني باستخدام PHP الأصلي (Native PHP) و MySQL، مع واجهة مستخدم تعتمد على Bootstrap 5. يهدف النظام إلى توفير وظائف لإدارة العقارات، الملاك، المستأجرين، عقود الإيجار، الفواتير، المدفوعات، وقراءات عدادات المرافق.

يتميز النظام بالتحضير للتكامل مع متطلبات الفوترة الإلكترونية لهيئة الزكاة والضريبة والجمارك (ZATCA) في المملكة العربية السعودية، مع الأخذ في الاعتبار استخدام مكتبات مساعدة لتوليد وتوقيع ملفات XML الخاصة بالفواتير.
s
## الميزات الرئيسية (المخطط لها والمكتملة جزئيًا)

* **لوحة تحكم رئيسية:** عرض ملخصات وإحصائيات عامة.
* **إدارة المستخدمين:**
    * تسجيل الدخول والخروج.
    * تسجيل مستخدمين جدد (بأدوار مختلفة).
    * إدارة المستخدمين الحاليين (عرض، تعديل، حذف، تغيير الدور) للمسؤول.
* **إدارة أصحاب العقارات:** إضافة، عرض، تعديل، حذف بيانات الملاك.
* **إدارة العقارات:** إضافة، عرض، تعديل، حذف بيانات العقارات وربطها بالمالك.
* **إدارة الوحدات:** (ضمن العقارات أو كوحدة منفصلة لاحقًا) إدارة تفاصيل الوحدات السكنية أو التجارية.
* **إدارة المستأجرين:** إضافة، عرض، تعديل، حذف بيانات المستأجرين.
* **إدارة عقود الإيجار:** إنشاء عقود إيجار، ربطها بالوحدات والمستأجرين، تحديد مدة العقد، مبلغ الإيجار، ودورية السداد.
* **إدارة الفواتير:**
    * إنشاء فواتير (إيجار، خدمات، إلخ).
    * إدارة بنود الفواتير.
    * تتبع حالة الفواتير (مدفوعة، غير مدفوعة، متأخرة).
    * **تكامل ZATCA (قيد التطوير):**
        * توليد XML للفواتير (مبسطة وقياسية) متوافق مع UBL 2.1.
        * حساب تجزئة الفاتورة (Invoice Hash).
        * توليد رمز الاستجابة السريعة (QR Code) بتنسيق TLV.
        * توقيع ملفات XML باستخدام شهادة تشفير.
        * (مستقبلاً) إرسال الفواتير إلى منصة ZATCA ومعالجة الردود.
* **إدارة المدفوعات:** تسجيل الدفعات المستلمة وربطها بالفواتير وتحديث حالة الفواتير.
* **إدارة المرافق وقراءات العدادات:** تسجيل قراءات عدادات الخدمات (كهرباء، ماء، إلخ) وحساب الاستهلاك.
* **إعدادات النظام:** صفحة للمسؤول لتعديل إعدادات التطبيق العامة وإعدادات ZATCA المخزنة في قاعدة البيانات.

## التقنيات المستخدمة

* **الخادم (Backend):** PHP أصلي (بدون إطارات عمل مثل Laravel أو Symfony).
* **قاعدة البيانات (Database):** MySQL.
* **الواجهة الأمامية (Frontend):**
    * HTML5.
    * Bootstrap 5 (للأنماط والتصميم المتجاوب).
    * Bootstrap Icons (للأيقونات).
    * JavaScript (أصلي و jQuery من CDN للاستخدامات البسيطة وتحسين واجهة المستخدم، خاصة مع النوافذ المنبثقة).
* **مكتبات PHP Propuesta (مقترحة/مستخدمة جزئيًا):**
    * `Saleh7/php-zatca-xml` (أو ما شابهها): لتوليد XML الفواتير وتوقيعها لـ ZATCA.

## هيكل المشروع

راجع الملفات والمجلدات داخل المشروع لفهم الهيكل التفصيلي. المجلدات الرئيسية تشمل:
* `auth/`: لملفات المصادقة.
* `owners/`, `properties/`, `tenants/`, `leases/`, `invoices/`, `payments/`, `utilities/`, `users/`: لكل وحدة رئيسية في النظام.
* `includes/`: للملفات المشتركة مثل (header, navigation, modals, functions).
* `sql_dump/`: يحتوي على مخطط قاعدة البيانات.
* `assets/`: للملفات الثابتة مثل الصور (إذا وجدت).
* `invoices/zatca_integration/`: مخصص للملفات المتعلقة بتكامل ZATCA.

## الإعداد والتشغيل

1.  **متطلبات الخادم:**
    * خادم ويب يدعم PHP (مثل Apache أو Nginx).
    * PHP (يفضل إصدار 7.4 أو أحدث، مع تمكين الامتدادات الضرورية مثل `mysqli`, `openssl`, `gd` لـ QR codes, `curl` للاتصال بـ API).
    * خادم MySQL أو MariaDB.
2.  **إنشاء قاعدة البيانات:**
    * قم بإنشاء قاعدة بيانات جديدة بالاسم المحدد في `config.php` (الافتراضي هو `amrsam99_inventory_db`).
    * قم باستيراد مخطط قاعدة البيانات والجداول من ملف `sql_dump/property_management.sql`.
3.  **تكوين الاتصال بقاعدة البيانات:**
    * عدّل ملف `config.php` بمعلومات الاتصال الصحيحة بقاعدة البيانات (DB_HOST, DB_USERNAME, DB_PASSWORD, DB_NAME).
4.  **إعدادات التطبيق و ZATCA:**
    * بعد إنشاء الجداول، قم بمراجعة وتحديث القيم في جدول `app_settings` في قاعدة البيانات، خاصة تلك المتعلقة بـ ZATCA (مثل مسارات الشهادات، معرفات العميل، إلخ) لتناسب بيئتك واشتراكك مع هيئة الزكاة.
5.  **مسارات الملفات:**
    * تأكد من أن مسارات الملفات (خاصة لشهادات ZATCA) في جدول `app_settings` هي مسارات مطلقة وصحيحة على خادمك.
    * تأكد من أن مجلد `uploads/contracts/` (أو أي مجلد رفع آخر يتم إنشاؤه) قابل للكتابة بواسطة خادم الويب.
6.  **الوصول إلى التطبيق:**
    * قم بتوجيه متصفحك إلى `APP_BASE_URL` الذي قمت بتعيينه في `config.php`.
    * **مستخدم افتراضي للمسؤول:**
        * اسم المستخدم: `admin`
        * كلمة المرور: `password123` (ينصح بشدة بتغييرها فورًا بعد تسجيل الدخول الأول).

## ملاحظات للمطورين

* **الأمان:** تم تضمين تدابير أمان أساسية مثل تنقية المدخلات، استخدام استعلامات مُعدَّة (prepared statements)، وحماية CSRF. يجب دائمًا مراجعة وتحديث الممارسات الأمنية.
* **تكامل ZATCA:** تكامل ZATCA عملية معقدة وتتطلب فهمًا دقيقًا لأدلة المطورين الخاصة بهيئة الزكاة. الكود المتعلق بـ ZATCA في هذا المشروع هو في مراحله الأولية ويحتاج إلى تطوير واختبار مكثف.
* **"بدون AJAX":** تم بناء النظام بناءً على طلب المستخدم لعدم استخدام AJAX بشكل أساسي لعمليات CRUD، مما يعني أن معظم عمليات النماذج تتضمن إعادة تحميل كاملة للصفحة.

## المساهمة
(هذا القسم يمكن تركه فارغًا أو تعديله إذا كان المشروع مفتوح المصدر ويقبل مساهمات)

---